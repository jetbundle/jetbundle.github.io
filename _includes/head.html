<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">

  <!-- Social: Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@{{ site.twitter_username }}">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
  <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  {% if page.image %}
  <meta property="twitter:image:src" content="{{ site.url }}{{ page.image }}">
  {% else %}
  <meta property="twitter:image:src" content="{{ site.url }}/assets/img/opengraph.png">
  {% endif %}

  <!-- Social: Facebook / Open Graph -->
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
  {% if page.image %}
  <meta property="og:image" content="{{ site.url }}{{ page.image }}">
  {% else %}
  <meta property="og:image" content="{{ site.url }}/assets/img/opengraph.png">
  {% endif %}
  <meta property="og:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:site_name" content="{{ site.title }}">

  <!-- Social: Schema.org  -->
  <meta itemprop="name" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}"/>

  <!-- jetbundle Gauge Theme - Critical CSS (inline for immediate rendering) -->
  <style>
    /* Critical gauge theme styles - applied immediately */
    :root {
      --orange-primary: #4f46e5;
      --orange-accent: #4338ca;
      --blue-primary: #4f46e5;
      --dark-bg: #0b0e17;
      --text-primary: #f1f5f9;
    }
    html, body, body.animated, body.animated.fadeIn {
      background: linear-gradient(135deg, #0b0e17 0%, #0a0d14 100%) !important;
      background-color: #0b0e17 !important;
      color: #f1f5f9 !important;
    }
    #background-div, #background-svg {
      background: #0b0e17 !important;
      background-color: #0b0e17 !important;
    }
    .bgColor1 { stop-color: #0b0e17 !important; }
    .bgColor2 { stop-color: #0a0d14 !important; }
    h1, h2, h3, h4, h5, h6, .post-title {
      color: #4f46e5 !important;
    }
    h1 {
      background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%) !important;
      -webkit-background-clip: text !important;
      -webkit-text-fill-color: transparent !important;
      background-clip: text !important;
    }
    a { color: #4f46e5 !important; }
    .navbar-icon, nav a, .navbar a { color: #94a3b8 !important; }
    .container, .wrapper, main { background: transparent !important; color: #f1f5f9 !important; }
    .content-div { color: #f1f5f9 !important; }

    /* CRITICAL: Hide theme navigation immediately */
    body > nav:not(header nav):not(.site-navbar),
    body > aside,
    body > .toolbar:not(.navbar-container),
    body > .sidebar,
    .toolbar:not(.navbar-container):not(.site-navbar),
    .sidebar {
      display: none !important;
      visibility: hidden !important;
    }

    /* Ensure our header is visible */
    header.site-header {
      display: block !important;
      visibility: visible !important;
    }

    /* Ensure jetbundle brand is visible and clickable */
    a.navbar-brand,
    a.jetbundle-logo,
    header a.navbar-brand {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      pointer-events: auto !important;
      cursor: pointer !important;
      color: #4f46e5 !important;
    }
  </style>

  <!-- Theme CSS -->
  <link rel="stylesheet" id="css-theme" href="/assets/css/main-dark.css">
  <link rel="stylesheet" href="/assets/css/highlight/monokai.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">

  <!-- jetbundle Gauge Theme CSS - Loads after theme CSS -->
  <link rel="stylesheet" href="/assets/css/gauge-theme.css">

  {% if site.math_engine_client == 'katex' %}
  <!-- KaTeX - PRIORITY: Load immediately for fast math rendering (before heavy scripts) -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"></noscript>

  <script>
    // Load KaTeX immediately (no defer) to prioritize math rendering
    (function() {
      var katexScript = document.createElement('script');
      katexScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js';
      katexScript.integrity = 'sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8';
      katexScript.crossOrigin = 'anonymous';
      katexScript.async = false; // Load synchronously to prioritize
      katexScript.onload = function() {
        // Load auto-render after KaTeX core is loaded
        var renderScript = document.createElement('script');
        renderScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js';
        renderScript.integrity = 'sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05';
        renderScript.crossOrigin = 'anonymous';
        renderScript.async = false;
        renderScript.onload = function() {
          if (window.renderMathInElement && document.body) {
            window.renderMathInElement(document.body, {
              delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\[', right: '\\]', display: true},
                {left: '\\(', right: '\\)', display: false}
              ],
              throwOnError: false,
              strict: false,
              trust: true,
              ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
              ignoredClasses: ['no-math']
            });
            console.log('KaTeX math rendered (priority load)');
          } else if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
              if (window.renderMathInElement) {
                window.renderMathInElement(document.body, {
                  delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                  ],
                  throwOnError: false,
                  strict: false,
                  trust: true,
                  ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                  ignoredClasses: ['no-math']
                });
              }
            });
          }
        };
        document.head.appendChild(renderScript);
      };
      document.head.appendChild(katexScript);
    })();
  </script>
  {% else %}
  <!-- MathJax 3 - Comprehensive LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams',
        autoload: {
          color: [],
          colorv2: ['color'],
          bbox: ['bbox'],
          cancel: ['cancel', 'bcancel', 'xcancel', 'cancelto'],
          enclose: ['enclose', 'cancel', 'color']
        }
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'table', 'thead', 'tbody', 'tr', 'td', 'th'],
        ignoreHtmlClass: 'no-math',
        processHtmlClass: 'math'
      },
      startup: {
        ready: () => {
          MathJax.startup.defaultReady();
          console.log('MathJax 3 is ready');
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  {% endif %}

  <!-- JavaScript: Load with defer to not block math rendering -->
  <!-- jQuery must load first, then Bootstrap (depends on jQuery), then D3, then theme JS -->
  <script defer src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script defer src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.3.0/d3.min.js"></script>
  <script defer src="/assets/js/main.js"></script>

  <!-- Manifold background - loads after page is ready (script handles its own initialization) -->
  <script defer src="/assets/js/manifold-background.js"></script>
</head>
